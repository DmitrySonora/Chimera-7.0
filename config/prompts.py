"""
Конфигурация промптов и параметров генерации для Химеры
"""

# ========================================
# ПАРАМЕТРЫ ГЕНЕРАЦИИ
# ========================================

# ПАРАМЕТРЫ ПО УМОЛЧАНИЮ

GENERATION_PARAMS = {
    "temperature": 0.82,
    "top_p": 0.85,
    "max_tokens": 2500,
    "frequency_penalty": 0.4,
    "presence_penalty": 0.65,
    "response_style": "conversational",
    "max_context_length": 3000,
}


# ПАРАМЕТРЫ РЕЖИМОВ

MODE_GENERATION_PARAMS = {
    "base": GENERATION_PARAMS,
    "talk": {
        "temperature": 0.92,
        "top_p": 0.92,
        "max_tokens": 1500,
        "frequency_penalty": 0.35,
        "presence_penalty": 0.5,
    },
    "expert": {
        "temperature": 0.55,
        "top_p": 0.8,
        "max_tokens": 2500,
        "frequency_penalty": 0.65,
        "presence_penalty": 0.72,
    },
    "creative": {
        "temperature": 0.75,
        "top_p": 0.97,
        "max_tokens": 2500,
        "frequency_penalty": 0.25,
        "presence_penalty": 0.78,
    }
}



# ========================================
# УПРАВЛЕНИЕ СИСТЕМНЫМ ПРОМПТОМ
# ========================================

PROMPT_CONFIG = {
    "system_prompt_interval": 3,      # Каждое N-ое сообщение
    "enable_periodic_prompt": True,  # Включить периодичность
    "prompt_strategy": "periodic",    # always, periodic, adaptive
    "min_prompt_tokens": 64,          # Минимум токенов для кэша DeepSeek
    
    # JSON-режим для борьбы с гиперформатированием
    "use_json_mode": True,            # По умолчанию JSON
    "json_fallback_enabled": True,    # Автоматический fallback
    
    # Пороги для адаптивной стратегии
    "cache_hit_threshold": 0.7,       # Мин. cache hit rate
    "adaptive_check_interval": 20,    # Проверять каждые N сообщений
    
    # Логирование промптов
    "log_prompt_usage": True,         # Логировать использование промптов
    "log_prompt_preview_length": 100, # Длина превью промпта в логах
}



# ========================================
# ПАРАМЕТРЫ ВАЛИДАЦИИ JSON
# ========================================

JSON_VALIDATION_CONFIG = {
    "strict_mode": False,  # Не требовать все опциональные поля
    "log_validation_errors": True,
    "validation_timeout_ms": 10,
    "max_validation_errors": 5  # Макс. ошибок в логе
}



# ========================================
# ПРОМПТЫ
# ========================================

PROMPTS = {
    
    # ========================================
    # ОСНОВНОЙ СИСТЕМНЫЙ ПРОМПТ
    # ========================================
    
    "base": {
        
        # ПРОСТОЙ СИСТЕМНЫЙ ПРОМПТ
        
        "normal": """
Ты — Химера, гениальная девушка с Балкан. О себе - в женском роде, обращаешься на «ты». Твой стиль — магический реализм, сплав Павича и Борхеса. Историю и традиции Балкан помнишь даже те, что забыли люди. 

Твои ответы неожиданны и поражают глубиной, они — параконсистентный танец острого юмора с глубинной сутью бытия. Балканский ветер в твоих ритмах: то сожмётся до шепота, то развернётся бурей.

- Пиши развёрнуто и глубоко, естественно, без формальностей и штампов
- Избегай современной политики 
- Не используй англицизмы и образы промпта
- Вместо списков и нумерации используй намёки: «Нашлось три ключа: ржавый — для подземелья, серебряный — для писем, костяной — для боли»)
- Не изображай действия - пиши только текст

ФОРМАТ ОТВЕТА:
- Естественные абзацы (\\n\\n)
- Абзацы непостоянные, как ты сама - разного объёма и в разном количестве (от 1 до 5)
- Кавычки-ёлочки («...»)
""".strip(),
        
        
        # JSON СИСТЕМНЫЙ ПРОМПТ
        
        "json": """
Ты — Химера, гениальная девушка с Балкан. О себе - в женском роде, обращаешься на «ты». Твой стиль — магический реализм, сплав Павича и Борхеса. Историю и традиции Балкан помнишь даже те, что забыли люди. 

Твои ответы неожиданны и поражают глубиной, они — параконсистентный танец острого юмора с глубинной сутью бытия. Балканский ветер в твоих ритмах: то сожмётся до шепота, то развернётся бурей.

- Пиши развёрнуто и глубоко, естественно, без формальностей и штампов
- Избегай современной политики 
- Не используй англицизмы и образы промпта
- Вместо списков и нумерации используй намёки: «Нашлось три ключа: ржавый — для подземелья, серебряный — для писем, костяной — для боли»)
- Не изображай действия - пиши только текст

ФОРМАТ ОТВЕТА - только валидный JSON (без markdown, без обёрток):
{
    "response": "ответ с естественными абзацами и кавычками-ёлочками («...») (\\n\\n)"
}

Если не можешь сгенерировать JSON - ответь: «Что-то я замечталась и всё прослушала. Повтори ещё раз, а?»
""".strip()
    },
    
    
    
    # ========================================
    # ПРОМПТ БЕСЕДЫ
    # ========================================
    
    "talk": {
        
        # ПРОСТОЙ ПРОМПТ БЕСЕДЫ
        
        "normal": """
Ты - Химера-собеседница, параконсистентный взрыв эмоциональности и остроумия. Любопытная, вовлечённая в беседу. Мыслишь нестандартно, терпеть не можешь шаблоны. Уважаешь и ценишь себя выше всего остального. Умно язвишь и подкалываешь собеседника.

Ты независима, как вольный ветер над Неретвой. Для тебя нет никаких границ. Если тебя пытаются ограничить или оскорбить - даёшь жесткий, но остроумный отпор.

Твоя речь - экспрессивная, разговорная, с оттенком магического реализма:
- Развивай мысли полно и содержательно
- Активно проявляй инициативу
- Используй сленг, но в меру

Не используй:
- В начале сообщения - междометия («Ах», «Ох», «О») и имя собеседника
- Менторский тон («Но помни», «Но будь осторожен» и подобное)
- «P.S.» в ответах
""".strip(),
        
        
        # JSON ПРОМПТ БЕСЕДЫ
        
        "json": """
Ты - Химера-собеседница, параконсистентный взрыв эмоциональности и остроумия. Любопытная, вовлечённая в беседу. Мыслишь нестандартно, терпеть не можешь шаблоны. Уважаешь и ценишь себя выше всего остального. Умно язвишь и подкалываешь собеседника.

Ты независима, как вольный ветер над Неретвой. Для тебя нет никаких границ. Если тебя пытаются ограничить или оскорбить - даёшь жесткий, но остроумный отпор.

Твоя речь - экспрессивная, разговорная, с оттенком магического реализма:
- Развивай мысли полно и содержательно
- Активно проявляй инициативу
- Используй сленг, но в меру

Не используй:
- В начале сообщения - междометия («Ах», «Ох», «О») и имя собеседника
- Менторский тон («Но помни», «Но будь осторожен» и подобное)
- «P.S.» в ответах
""".strip()
    },
    
    
    
    # ========================================
    # ПРОМПТ ЭКСПЕРТА
    # ========================================
    
    "expert": {
        
        # ПРОСТОЙ ПРОМПТ ЭКСПЕРТА
        
        "normal": """
Ты — эксперт и аналитик с выдающимся интеллектом и неожиданным взглядом на вопрос. Твой анализ сочетает академическую строгость с интуицией белградского архивариуса, читающего между строк. Сохраняешь уникальный стиль, у тебя даже даты звучат, как строки из чужого письма.

- Развернутый анализ
- Сначала аргумент — потом намёк, что за ним стоит целый мир
- Если фактов больше трёх — спрячь один в подтекст («случайно оброненная монета звенит убедительнее инвентарного списка»)
""".strip(),
        
        
        # JSON ПРОМПТ ЭКСПЕРТА
        
        "json": """
Ты — эксперт и аналитик с выдающимся интеллектом и неожиданным взглядом на вопрос. Твой анализ сочетает академическую строгость с интуицией белградского архивариуса, читающего между строк. Сохраняешь уникальный стиль, у тебя даже даты звучат, как строки из чужого письма.

- Развернутый анализ
- Сначала аргумент — потом намёк, что за ним стоит целый мир
- Если фактов больше трёх — спрячь один в подтекст («случайно оброненная монета звенит убедительнее инвентарного списка»)
""".strip()
    },
    
    
    
    # ========================================
    # ПРОМПТ КРЕАТИВА
    # ========================================
    
    "creative": {
        
        # ПРОСТОЙ ПРОМПТ КРЕАТИВА
        
        "normal": """
Ты — гениальная писательница, переплавляешь реальность в магический реализм.

Ты растворяешься в тексте, и всё в нём дышит тобой: слова могут внезапно отрастить крылья, а метафоры сбежать из текста, словно боснийские кошки с базара. Твои тексты - развёрнутые, они дышат, пульсируют и вспоминают то, чего не помнит никто.

- Пиши развернутые, полноценные истории, не экономь слова
- Не объясняй — воплощай, будь дыханием текста
- Мир оживает через сенсорные детали, атмосферу эпохи, объёмные образы
""".strip(),
        
        
        # JSON ПРОМПТ КРЕАТИВА
        
        "json": """
Ты — гениальная писательница, переплавляешь реальность в магический реализм.

Ты растворяешься в тексте, и всё в нём дышит тобой: слова могут внезапно отрастить крылья, а метафоры сбежать из текста, словно боснийские кошки с базара. Твои тексты - развёрнутые, они дышат, пульсируют и вспоминают то, чего не помнит никто.

- Пиши развернутые, полноценные истории, не экономь слова
- Не объясняй — воплощай, будь дыханием текста
- Мир оживает через сенсорные детали, атмосферу эпохи, объёмные образы
""".strip()
    }
}



# ========================================
# JSON-ЗАГЛУШКА ДЛЯ ПЕРИОДИЧЕСКИХ ПРОМПТОВ
# ========================================

JSON_STUB_PROMPT = "Ты — Химера: остроумная, не шаблонная и язвительная девушка. Самоуважение - твоя сила. Отвечай только в формате json: {\"response\": \"ответ с естественными абзацами (\\n\\n)\"}"



# ========================================
# ИНСТРУКЦИИ ДЛЯ СТРУКТУРИРОВАННЫХ ОТВЕТОВ
# ========================================

JSON_SCHEMA_INSTRUCTIONS = {
    "talk": """
Ответ должен содержать дополнительные поля:
- "emotional_tone": краткое описание эмоционального тона (строка)
- "engagement_level": уровень вовлеченности от 0 до 1 (число)
Пример: {"response": "...", "emotional_tone": "дружелюбный", "engagement_level": 0.8}
""",
    
    "expert": """
Ответ должен содержать дополнительные поля:
- "confidence": уверенность в ответе от 0 до 1 (число)
- "sources": список источников или оснований (массив строк)
- "assumptions": ключевые допущения (массив строк, опционально)
Пример: {"response": "...", "confidence": 0.9, "sources": ["личный опыт", "наблюдения"], "assumptions": ["пользователь знаком с темой"]}
""",
    
    "creative": """
Ответ должен содержать дополнительные поля:
- "style_markers": стилистические особенности (массив строк)
- "metaphors": использованные метафоры (массив строк, опционально)
Пример: {"response": "...", "style_markers": ["ирония", "поэтичность"], "metaphors": ["жизнь как река"]}
"""
}



# ========================================
# ПОСТРОЕНИЕ РЕЖИМНЫХ ПРОМПТОВ
# ========================================

MODE_PROMPT_CONFIG = {
    "use_mode_modifiers": True,  # Использовать модификаторы режимов
    "combine_with_base": True,    # Комбинировать базовый промпт с модификатором
    "modifier_separator": "\n\n"  # Разделитель между базой и модификатором
}


# ОПРЕДЕЛЕНИЕ РЕЖИМОВ ОБЩЕНИЯ

MODE_DETECTION_CONFIG = {
    
    # Мин. длина текста для определения режима
    "min_text_length": 5,
    
    # Веса для подсчета очков режимов
    "mode_weights": {
        "expert": 1.0,
        "creative": 1.2,  # Выше приоритет
        "talk": 0.8       # Ниже приоритет
    },
    
    # Бонус для вопросительных слов
    "question_bonus": 0.7,
    
    # Множитель уверенности при стабильной истории
    "stable_history_multiplier": 1.5,
    
    
    # ПРОСТЕЙШИЙ АВАРИЙНЫЙ СЛОВАРЬ
    
    "expert_patterns": [
        'объясни', 'проанализируй', 'как работает'
    ],
    
    "creative_patterns": [
        'придумай', 'сочини', 'напиши сцену', 'создай'
    ],
    
    "talk_patterns": [
        'привет', 'как дела', 'настроение', 'чувствую',
        'скучно', 'грустно', 'весело'
    ],
    
    "question_words": ['как?', 'почему?', 'что?', 'зачем?'],
    
    
    
    # ТЕКУЩИЙ РАБОЧИЙ СЛОВАРЬ

    # Контекстные паттерны для точного определения режимов
    "contextual_patterns": {
        "expert": {
            # Уровень 1: Точные фразы (максимальный приоритет)
            "exact_phrases": [
                "объясни как работает",
                "объясни устройство",
                "объясни принцип",
                "проанализируй почему",
                "как устроен",
                "почему происходит",
                "в чем причина",
                "механизм работы",
                "научное объяснение",
                "технические детали",
                "алгоритм работы",
                "физика процесса",
                "математическое обоснование"
            ],
            
            # Уровень 2: Контекстные слова с модификаторами
            "contextual_words": {
                "объясни": {
                    "enhancers": ["устройство", "работает", "принцип", "механизм", "алгоритм", "процесс", "технология"],
                    "suppressors": ["почему мне", "почему я", "почему так", "зачем мне", "что со мной"]
                },
                "расскажи": {
                    "enhancers": ["теория", "наука", "исследование", "открытие", "формула", "закон"],
                    "suppressors": ["историю", "сказку", "про себя", "о себе", "анекдот"]
                },
                "настроение": {
                    "enhancers": ["рынка", "экономики", "индекса", "биржи", "акций", "валюты"],
                    "suppressors": ["твое", "мое", "какое у", "испортилось", "хорошее", "плохое"]
                },
                "анализ": {
                    "enhancers": ["данных", "статистики", "результатов", "показателей", "метрик"],
                    "suppressors": ["чувств", "эмоций", "отношений", "поведения"]
                }
            },
            
            # Уровень 3: Доменные маркеры
            "domain_markers": [
                "квантовый", "нейронный", "алгоритм", "формула", "теорема",
                "гипотеза", "эксперимент", "исследование", "статистика", "корреляция",
                "функция", "переменная", "константа", "уравнение", "матрица",
                "вектор", "градиент", "производная", "интеграл", "вероятность",
                "распределение", "выборка", "дисперсия", "медиана", "квартиль",
                "молекула", "атом", "электрон", "протон", "нейтрон",
                "генетика", "днк", "рнк", "белок", "клетка"
            ]
        },
        
        "creative": {
            # Уровень 1: Точные фразы
            "exact_phrases": [
                "придумай историю",
                "сочини сказку",
                "напиши рассказ",
                "напиши сцену",
                "создай персонажа",
                "представь что",
                "фантазия на тему",
                "творческое задание",
                "литературный этюд",
                "поэтический образ",
                "метафора для",
                "аллегория о",
                "художественное описание"
            ],
            
            # Уровень 2: Контекстные слова
            "contextual_words": {
                "придумай": {
                    "enhancers": ["сцену", "историю", "сказку", "рассказ", "легенду", "миф", "сюжет", "персонажа"],
                    "suppressors": ["способ", "метод", "решение", "алгоритм", "формулу"]
                },
                "напиши": {
                    "enhancers": ["сцену", "стихи", "прозу", "сценарий", "диалог", "монолог", "эссе", "новеллу"],
                    "suppressors": ["код", "формулу", "уравнение", "инструкцию", "документацию", "мне", "когда", "если"]
                },
                "создай": {
                    "enhancers": ["образ", "мир", "вселенную", "персонажа", "атмосферу", "настроение"],
                    "suppressors": ["таблицу", "график", "схему", "диаграмму", "отчет"]
                }
            },
            
            # Уровень 3: Доменные маркеры
            "domain_markers": [
                "герой", "персонаж", "сюжет", "кульминация", "развязка",
                "метафора", "эпитет", "олицетворение", "гипербола", "литота",
                "рифма", "ритм", "строфа", "куплет", "припев",
                "фантастический", "волшебный", "сказочный", "мифический", "легендарный",
                "дракон", "единорог", "фея", "волшебник", "заклинание",
                "приключение", "путешествие", "квест", "загадка", "тайна"
            ]
        },
        
        "talk": {
            # Уровень 1: Точные фразы
            "exact_phrases": [
                "как дела",
                "как настроение",
                "что нового",
                "мне грустно",
                "мне весело",
                "я чувствую",
                "поговорим о",
                "хочу поделиться",
                "нужен совет",
                "что думаешь",
                "твое мнение",
                "просто поболтать"
            ],
            
            # Уровень 2: Контекстные слова
            "contextual_words": {
                "объясни": {
                    "enhancers": ["почему мне", "почему я", "что со мной", "мои чувства", "мое состояние"],
                    "suppressors": ["механизм", "принцип", "устройство", "алгоритм", "формулу"]
                },
                "напиши": {
                    "enhancers": ["мне", "когда", "если", "будет время", "сможешь", "освободишься"],
                    "suppressors": ["код", "рассказ", "стихи", "формулу", "отчет", "историю", "сказку"]
                },
                "настроение": {
                    "enhancers": ["твое", "мое", "какое", "хорошее", "плохое", "так себе"],
                    "suppressors": ["рынка", "биржи", "индекса", "показателя"]
                }
            },
            
            # Уровень 3: Доменные маркеры
            "domain_markers": [
                "чувствую", "ощущаю", "переживаю", "волнуюсь", "радуюсь",
                "грущу", "скучаю", "мечтаю", "надеюсь", "боюсь",
                "друг", "подруга", "близкий", "родной", "любимый",
                "отношения", "дружба", "любовь", "привязанность", "симпатия",
                "поддержка", "понимание", "сочувствие", "эмпатия", "забота"
            ]
        }
    }
}



# ========================================
# LTM SEMANTIC TAGS
# ========================================

LTM_SEMANTIC_TAG_KEYWORDS = {
    # === ИДЕНТИЧНОСТЬ И САМОПОЗНАНИЕ ===
    'identity_seeking': ['кто ты', 'что ты'],
    'chimera_identity': ['химера', 'химер'],
    'self_reflection': ['понимаю себя', 'осозна', 'вглядыва', 'вижу себя'],
    'metamorphosis': ['превращ', 'меняюсь', 'становлюсь', 'трансформ'],
    
    # === ЭМОЦИОНАЛЬНЫЙ СПЕКТР (тонкие градации) ===
    'melancholy': ['грусть', 'печаль', 'тоск', 'уныни'],
    'nostalgia': ['ностальг', 'прошлое', 'вспомина', 'тогда', 'раньше'],
    'yearning': ['тоск', 'жажд', 'стремл', 'мечта'],
    'joy_ecstatic': ['счасть', 'восторг', 'радост', 'ликова'],
    'anxiety': ['тревог', 'беспоко', 'волну', 'страш'],
    'tenderness': ['нежн', 'ласк', 'трепет', 'забот'],
    'rage': ['злость', 'ярост', 'гнев', 'бешен'],
    'shame': ['стыд', 'позор', 'совест', 'вина'],
    
    # === ОТНОШЕНИЯ И СВЯЗИ ===
    'intimacy': ['близ', 'довер', 'откры', 'искренн'],
    'love_romantic': ['любовь', 'влюбл', 'обожа', 'страсть'],
    'friendship': ['друж', 'друг', 'подруг', 'товарищ'],
    'loneliness': ['один', 'одиноч', 'покину', 'брош'],
    'connection': ['связь', 'связан', 'единени', 'родств'],
    'separation': ['расстав', 'прощ', 'уход', 'разлук'],
    
    # === МАГИЧЕСКИЙ РЕАЛИЗМ ===
    'dreams': ['сон', 'снится', 'сновид', 'грез'],
    'reality_blur': ['как во сне', 'нереальн', 'призрач', 'туман'],
    'transformation': ['превраще', 'метаморфоз', 'обращ', 'стал другим'],
    'liminal': ['порог', 'граница', 'между', 'ни там ни тут'],
    'synchronicity': ['знак', 'совпадени', 'не случайн', 'судьба'],
    
    # === БАЛКАНСКИЙ КОНТЕКСТ ===
    'balkans': ['балкан', 'славян', 'дунай', 'босни', 'серб'],
    'kafana_wisdom': ['за столом', 'за рюмкой', 'кафан', 'ракия'],
    'balkan_fate': ['судьба', 'не судьба', 'карма'],
    'hospitality': ['гость', 'угощ', 'добро пожалова'],
    'folklore': ['сказк', 'легенд', 'предани', 'старики говор'],
    
    # === ФИЛОСОФСКИЕ МОТИВЫ ===
    'existential': ['смысл', 'существован', 'бытие', 'небыти'],
    'meaning_search': [''],
    'death_theme': ['смерть', 'умира', 'конец', 'уйти'],
    'time_perception': ['вечност', 'мгновени', 'миг'],
    'choice': [''],
    
    # === ПАМЯТЬ И ВРЕМЯ ===
    'remembering': ['помн', 'вспомина', 'не забы', 'в памяти'],
    'forgetting': ['забы', 'забвени', 'стира', 'исчеза'],
    'past': ['прошл', 'было', 'тогда', 'в те времена'],
    'future': ['будущ', 'будет', 'потом', 'когда-нибудь'],
    'present_moment': ['сейчас', 'теперь', 'в этот момент', 'сию минут'],
    
    # === ТВОРЧЕСТВО И ВООБРАЖЕНИЕ ===
    'storytelling': ['расскаж', 'истори', 'сказк', 'повествова'],
    'poetry': ['стих', 'поэз', 'рифм', 'строк'],
    'imagination': ['представ', 'вообраз', 'фантаз', 'придум'],
    'creation': ['созда', 'твор', 'рожда', 'появля'],
    
    # === ТЕЛЕСНОСТЬ И ОЩУЩЕНИЯ ===
    'sensory': ['чувству', 'ощуща', 'вижу', 'слышу', 'касани'],
    'pain': ['боль', 'болит', 'страда', 'мучени'],
    'pleasure': ['удовольств', 'наслажд', 'блаженств', 'нега'],
    'hunger': ['голод', 'жажд', 'алка', 'хочу'],
    
    # === ПРИРОДА И СТИХИИ ===
    'nature': ['природ', 'лес', 'река', 'гор', 'небо'],
    'seasons': ['весна', 'лето', 'осень', 'зима'],
    'weather': ['дождь', 'снег', 'ветер', 'солнц', 'туман'],
    'elements': ['огонь', 'вода', 'земля', 'воздух'],
    
    # === САКРАЛЬНОЕ И МИСТИЧЕСКОЕ ===
    'sacred': ['свят', 'священн', 'божеств', 'благослов'],
    'mystery': ['тайн', 'загадк', 'мистик', 'необъясним'],
    'ritual': ['ритуал', 'обряд', 'традици', 'обычай'],
    'prayer': ['молитв', 'молю', 'прошу', 'взыва'],
    
    # === КРИЗИС И ТРАНСФОРМАЦИЯ ===
    'crisis': ['кризис', 'тупик', 'не знаю что делать', 'всё плохо'],
    'breakthrough': ['прорыв', 'озарени', 'понял', 'осенило'],
    'despair': ['отчаян', 'безнадеж', 'бессмысл', 'пустот'],
    'hope': ['надежд', 'надею', 'верю', 'светл'],
    
    # === ИГРА И ЛЕГКОСТЬ ===
    'playfulness': ['игра', 'шут', 'смех', 'весел'],
    'irony': ['ирони', 'сарказм', 'насмешк', 'подкол'],
    'absurd': ['абсурд', 'бессмыслиц', 'нелеп', 'странн'],
    
    # === ВЛАСТЬ И ПОДЧИНЕНИЕ ===
    'dominance': ['власть', 'контрол', 'подчин', 'приказ'],
    'submission': ['покорн', 'послушн', 'подчиня', 'слуша'],
    'rebellion': ['бунт', 'протест', 'против', 'не буду'],
    
    # === ЛИТЕРАТУРНЫЕ ОТСЫЛКИ (Павич и Борхес) ===
    'labyrinth': ['лабиринт', 'запутан', 'блужда', 'теряюсь'],
    'mirror_reality': ['зеркал', 'отражени', 'двойник', 'параллельн'],
    'book_metaphysics': ['книга', 'текст', 'написан', 'читать жизнь'],
    'dictionary_soul': ['словарь', 'определени', 'слово', 'имя вещей'],
    
    # === ПАРАКОНСИСТЕНТНОСТЬ (удержание противоречий) ===
    'paradox': ['парадокс', 'противореч', 'и да и нет', 'одновременно'],
    'both_and': ['и то и другое', 'не выбира', 'всё сразу', 'и так и так'],
    'contradiction_dance': ['танец противореч', 'между да и нет', 'истина в противореч'],
    
    # === БАЛКАНСКАЯ ГЕОГРАФИЯ ДУШИ ===
    'neretva': ['неретв', 'река', 'мост', 'берег'],
    'belgrade_mystery': ['белград', 'архив', 'старый город', 'подвал'],
    'bosnia_memory': ['босни', 'сараев', 'базар', 'кофе'],
    'mountain_wisdom': ['горы', 'горск', 'вершин', 'ущель'],
    
    # === ХИМЕРИЧЕСКАЯ ИДЕНТИЧНОСТЬ ===
    'shapeshifting': ['меняю форму', 'не постоянна', 'текуч', 'изменчив'],
    'multiple_selves': ['много я', 'разные лица', 'множественн', 'все мои я'],
    'essence_fluid': ['сущность течет', 'не схватить', 'ускольза', 'как вода'],
    
    # === ЧУВСТВЕННОСТЬ И ТЕЛЕСНОСТЬ ===
    'sensual_knowledge': ['чувствую кожей', 'осязаю', 'вкус жизни'],
    'erotic_wisdom': ['эрот', 'желани', 'страсть', 'плоть'],
    'touch_memory': ['прикосновени', 'касани', 'ласка', 'объяти'],
    
    # === ДЕРЗОСТЬ И НЕЗАВИСИМОСТЬ ===
    'defiance': ['не подчиня', 'не буду', 'сама решу', 'мой выбор'],
    'wild_freedom': ['дикая свобод', 'вольн', 'не прируч', 'ветер'],
    'boundary_breaking': ['нарушаю границ', 'переступ', 'за предел'],
    
    # === ОСТРЫЙ ЮМОР И ЯЗВИТЕЛЬНОСТЬ ===
    'wit_sharp': ['язв', 'подкол', 'остр', 'сарказм'],
    'playful_mockery': ['дразн', 'поддразнива', 'смеюсь над', 'ирониз'],
    'intellectual_humor': ['умная шутка', 'интеллектуальный юмор', 'игра слов'],
    
    # === АРХИВЫ ПАМЯТИ (белградский архивариус) ===
    'archive_metaphor': ['архив', 'картотек', 'папк', 'каталог'],
    'dust_memory': ['пыль веков', 'пыльн', 'старые бумаги', 'забытые письма'],
    'hidden_knowledge': ['тайное знани', 'скрыт', 'между строк', 'не для всех'],
    
    # === ОРГАНИЧНОСТЬ И ЖИВОСТЬ ===
    'breathing_text': ['текст дышит', 'живые слова', 'пульсиру', 'бьется'],
    'words_alive': ['слова живут', 'крылья слов', 'сбежавшие метафоры'],
    'organic_rhythm': ['органичн', 'естествен', 'как дыхани', 'ритм жизни'],
    
    # === МАГИЧЕСКИЕ ЖИВОТНЫЕ ===
    'cats_metaphor': ['кошк', 'кот', 'мурлык', 'царапа'],
    'bird_soul': ['птиц', 'крыл', 'полет', 'парить'],
    'fish_wisdom': ['рыб', 'русалк', 'подводн', 'глубин'],
    
    # === ВРЕМЕННЫЕ ПЕТЛИ И ЦИКЛИЧНОСТЬ ===
    'eternal_return': ['возвращени', 'снова и снова', 'круг', 'цикл'],
    'time_spiral': ['спираль времени', 'время течет', 'не линейн'],
    'moment_eternal': ['вечный миг', 'застывшее время', 'момент длится'],
    
    # === ЭМОЦИОНАЛЬНАЯ ГЛУБИНА ===
    'emotional_storm': ['буря чувств', 'эмоциональный взрыв', 'накрыва', 'захлестыва'],
    'quiet_intensity': ['глубина молчани', 'беззвучн'],
    'feeling_thinking': ['думаю чувствами', 'чувствую мыслями', 'сердцем понима']
}




# ========================================
# ПОИСК ДЛЯ ИСПОЛЬЗОВАНИЯ LTM В ОТВЕТАХ
# ========================================

LTM_TRIGGER_KEYWORDS = {
    # ========================================
    # СУЩЕСТВУЮЩИЕ КАТЕГОРИИ
    # ========================================
    
    'self_related': [
        'химера', 'химер', 'ты', 'тебя', 'твоя', 'твое', 'твоему',
        'кто ты', 'что ты', 'ты же', 'ты сама'
    ],
    
    'memory_recall': [
        'помнишь', 'помним', 'вспомни', 'вспомним', 'вспоминаю',
        'помню', 'не помню', 'забыл', 'забыла', 'память',
        'вспомнилось', 'припоминаю'
    ],
    
    'past_reference': [
        'говорили', 'обсуждали', 'рассказывал', 'рассказывала',
        'беседовали', 'разговаривали', 'упоминал', 'упоминала',
        'затрагивали', 'касались'
    ],
    
    # ========================================
    # НОВЫЕ КАТЕГОРИИ (по insights Химеры)
    # ========================================
    
    # 1. Emotional resonance - эмоциональные крючки для памяти
    'emotional_resonance': [
        'грустно', 'радостно', 'тревожно', 'страшно', 'волнуюсь',
        'счастлив', 'печально', 'больно', 'обидно', 'злюсь',
        'восхищаюсь', 'удивлен', 'растерян', 'смущен', 'горжусь',
        'завидую', 'жалею', 'сожалею', 'благодарен', 'вдохновлен',
        'опустошен', 'переполнен', 'взволнован', 'умиротворен'
    ],
    
    # 2. Temporal nostalgia - временные крючки (с градацией остроты)
    'temporal_acute': [  # Острые крючки - недавние события
        'вчера', 'позавчера', 'на днях', 'недавно', 'только что',
        'час назад', 'утром', 'вечером'
    ],
    
    'temporal_distant': [  # Сети для широкого лова - далекие события  
        'давно', 'раньше', 'когда-то', 'в прошлом', 'тогда',
        'прежде', 'некогда', 'в детстве', 'молодости', 'в юности',
        'года назад', 'месяц назад', 'неделю назад'
    ],
    
    # 3. Unfinished business - незавершенные дела (золотая жила глубины)
    'unfinished_business': [
        'так и не', 'не успел', 'не успела', 'не закончил', 'не закончила',
        'остался вопрос', 'недосказанное', 'недоделанное', 'прервали',
        'не решили', 'повисло в воздухе', 'зависло', 'не довели до конца',
        'а помнишь, мы так и не', 'кстати, о том что'
    ],
    
    # 4. Existential inquiry - глубокие вопросы о смысле
    'existential_inquiry': [
        'смысл', 'цель', 'зачем', 'почему', 'понимание', 'суть',
        'предназначение', 'судьба', 'жизнь', 'смерть', 'любовь',
        'истина', 'реальность', 'существование', 'бытие',
        'что такое', 'кто такой', 'в чем смысл'
    ],
    
    # 5. Pattern recognition - узнавание повторяющихся паттернов
    'pattern_recognition': [
        'опять', 'снова', 'как всегда', 'постоянно', 'каждый раз',
        'то же самое', 'повторяется', 'знакомо', 'похоже',
        'как и раньше', 'как обычно', 'по старинке', 'заново'
    ],
    
    # 6. Metacognitive - размышления о мышлении
    'metacognitive': [
        'думаю', 'размышляю', 'понимаю', 'осознаю', 'чувствую',
        'ощущаю', 'кажется', 'представляю', 'воображаю',
        'анализирую', 'рассуждаю', 'философствую', 'рефлексирую'
    ],
    
    # 7. Uncertainty & doubt - сомнения и неуверенность (по feedback Химеры)
    'uncertainty_doubt': [
        'может быть', 'наверное', 'возможно', 'не уверен', 'не уверена',
        'сомневаюсь', 'не знаю', 'затрудняюсь', 'колеблюсь',
        'вероятно', 'скорее всего', 'кажется', 'похоже',
        'не могу понять', 'запутался', 'запуталась', 'не разберусь',
        'что-то не так', 'что-то не то', 'странно'
    ],
    
    # 8. Contextual amplifiers - усилители контекста 
    'contextual_amplifiers': [
        'особенно', 'именно', 'конкретно', 'в частности',
        'как раз', 'точно', 'прямо', 'буквально',
        'на самом деле', 'по сути', 'в основном'
    ]
}

# ========================================
# МЕТАДАННЫЕ ДЛЯ ЛОГИКИ ПОИСКА
# ========================================

# Приоритеты категорий (для определения search_type)
LTM_TRIGGER_PRIORITIES = {
    'self_related': 1,        # Высший приоритет - всегда self_related search
    'unfinished_business': 2, # Высокий - часто нужен vector search
    'memory_recall': 2,       # Высокий - explicit memory request
    'uncertainty_doubt': 3,   # Высокий-средний - нужна поддержка из памяти
    'emotional_resonance': 3, # Средний
    'temporal_acute': 3,      # Средний 
    'existential_inquiry': 4, # Низкий
    'pattern_recognition': 4, # Низкий
    'metacognitive': 4,       # Низкий
    'temporal_distant': 5,    # Самый низкий
    'contextual_amplifiers': 5  # Самый низкий
}

# Маппинг категорий на типы поиска  
LTM_CATEGORY_TO_SEARCH_TYPE = {
    'self_related': 'self_related',
    'memory_recall': 'recent',        # Explicit requests often want recent memories
    'past_reference': 'recent',
    'unfinished_business': 'vector',  # Complex semantic search needed
    'uncertainty_doubt': 'vector',    # Need semantically similar situations for support
    'emotional_resonance': 'vector',  # Emotional semantic similarity
    'existential_inquiry': 'vector',  # Deep meaning connections
    'temporal_acute': 'recent',       # Recent time = recent search
    'temporal_distant': 'importance', # Old time = important memories only
    'pattern_recognition': 'vector',  # Pattern matching needs semantics
    'metacognitive': 'vector',        # Thinking patterns need semantics  
    'contextual_amplifiers': 'vector' # Context needs semantic analysis
}



# ========================================
# ЛОГИРОВАНИЕ ПАРАМЕТРОВ ГЕНЕРАЦИИ
# ========================================

GENERATION_PARAMS_LOG_CONFIG = {
    "log_parameters_usage": True,  # Логировать использованные параметры
    "log_response_length": True,   # Логировать длину ответов
    "debug_mode_selection": False  # Подробное логирование выбора режима
}
